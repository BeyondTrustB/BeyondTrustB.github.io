<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>BeyondTrust Bank – Card Hub</title>
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
        }
        body {
            background: #dbe6f0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }
        .bank-app {
            max-width: 1300px;
            width: 100%;
            background: white;
            border-radius: 32px 32px 24px 24px;
            box-shadow: 0 20px 40px -10px rgba(0,30,60,0.3);
            overflow: hidden;
        }
        /* header */
        .header {
            background: linear-gradient(148deg, #00203d, #003866);
            color: white;
            padding: 1.2rem 1.5rem;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            background: rgba(255,255,255,0.12);
            padding: 6px 16px;
            border-radius: 40px;
            font-size: 0.9rem;
            border: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 8px;
        }
        .header h1 {
            font-size: clamp(1.8rem, 5vw, 2.2rem);
            font-weight: 600;
        }
        .header p {
            opacity: 0.85;
            font-size: clamp(0.9rem, 3vw, 1rem);
        }

        /* main layout - flex with wrap for mobile */
        .main-layout {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px 18px;
            background: #f7fafd;
        }
        .left-column {
            flex: 2;
            min-width: 320px;
            width: 100%;
        }
        .right-column {
            flex: 1.2;
            min-width: 280px;
            width: 100%;
            background: white;
            border-radius: 28px;
            padding: 20px 18px;
            box-shadow: 0 8px 20px rgba(0,40,70,0.08);
            border: 1px solid #d9e6f5;
            align-self: start;
        }

        /* 3D card - responsive sizing */
        .card-3d-perspective {
            perspective: 1600px;
            margin-bottom: 22px;
            width: 100%;
            display: flex;
            justify-content: center;
        }
        .card-3d {
            width: min(440px, 95%);
            max-width: 460px;
            height: auto;
            aspect-ratio: 460/280;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.5s ease;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 25px 35px -12px #001e3c;
        }
        .card-3d.flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            padding: clamp(12px, 3vw, 22px) clamp(14px, 4vw, 26px);
            background: linear-gradient(140deg, #021c30, #0e334e);
            color: white;
            border: 1px solid rgba(255,255,200,0.2);
            box-shadow: inset 0 -2px 5px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        /* front */
        .front {
            background: radial-gradient(circle at 30% 40%, #1b4b6e, #00253d);
        }
        .card-header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .chip {
            width: clamp(38px, 8vw, 48px);
            height: clamp(28px, 6vw, 36px);
            background: linear-gradient(145deg, #e9cf9a, #bfa25e);
            border-radius: 8px 4px 8px 4px;
            box-shadow: 0 3px 6px black;
            position: relative;
        }
        .chip::after {
            content: "";
            position: absolute;
            inset: 4px;
            background: repeating-linear-gradient(45deg, #9e813e 0px, #9e813e 2px, #dbb471 2px, #dbb471 4px);
            border-radius: 4px;
        }
        .brand {
            font-size: clamp(1.6rem, 6vw, 2.4rem);
            font-weight: 700;
            letter-spacing: 1px;
            color: white;
        }
        .card-number {
            font-family: 'Courier New', monospace;
            font-size: clamp(1rem, 4vw, 1.7rem);
            letter-spacing: 2px;
            background: rgba(0,0,0,0.4);
            padding: clamp(6px, 2vw, 12px) clamp(8px, 3vw, 14px);
            border-radius: 14px;
            text-align: center;
            margin: 8px 0 6px;
            backdrop-filter: blur(3px);
            border: 1px solid rgba(255,255,240,0.2);
            transition: filter 0.2s;
            word-break: break-word;
            color: white;                
            -webkit-text-fill-color: white;
            user-select: none;           
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .card-number.blurred {
            filter: blur(5px);
        }
        .name-exp-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: flex-end;
            gap: 8px;
        }
        .holder-name {
            text-transform: uppercase;
            font-size: clamp(0.9rem, 3.5vw, 1.35rem);
            font-weight: 500;
            letter-spacing: 1px;
            color: white;
        }
        .expiry {
            font-size: clamp(0.8rem, 3vw, 1.3rem);
            background: rgba(0,0,0,0.4);
            padding: 3px 10px;
            border-radius: 30px;
            color: white;
        }
        .mastercard-icon {
            font-size: clamp(1.5rem, 5vw, 2.4rem);
            text-align: right;
            color: white;
        }
        /* back face */
        .back {
            transform: rotateY(180deg);
            background: linear-gradient(155deg, #0b2538, #1e3d58);
            justify-content: flex-start;
            padding: clamp(12px, 3vw, 22px);
        }
        .mag-strip {
            background: #1f1f28;
            height: clamp(30px, 5vw, 42px);
            width: 100%;
            margin: 10px 0 15px;
        }
        .cvv-block {
            background: #ecf0f5;
            color: #000;
            padding: 6px 14px;
            border-radius: 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 95%;
            margin: 0 auto;
            font-weight: 600;
            flex-wrap: wrap;
        }
        .cvv-value {
            font-family: monospace;
            font-size: clamp(1.2rem, 5vw, 2rem);
            background: white;
            padding: 2px 18px;
            border-radius: 30px;
            color: black;
            user-select: none;
        }
        .customer-service {
            margin-top: 15px;
            font-size: 0.7rem;
            color: #bfd9ff;
            background: rgba(0,20,40,0.7);
            padding: 8px;
            border-radius: 16px;
        }
        .legal-text {
            font-size: 0.6rem;
            line-height: 1.3;
            color: #cbdae9;
            margin-top: 12px;
            max-height: 90px;
            overflow-y: auto;
        }
        /* billing address */
        .billing-panel {
            background: #e3effa;
            border-radius: 24px;
            padding: 18px;
            margin: 20px 0 15px;
            border: 1px solid #aac5e2;
            transition: opacity 0.2s;
        }
        .billing-panel.hidden {
            opacity: 0.3;
            pointer-events: none;
            filter: blur(4px);
        }
        .billing-details {
            display: flex;
            flex-wrap: wrap;
            gap: 12px 20px;
            background: white;
            padding: 14px;
            border-radius: 20px;
        }
        .bill-item {
            display: flex;
            flex-direction: column;
        }
        .bill-label {
            font-size: 0.65rem;
            color: #346792;
        }
        .bill-value {
            font-weight: 600;
            color: #001e3b;
            font-size: 0.9rem;
        }
        /* buttons */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 10px 0 5px;
        }
        .primary-btn, .secondary-btn, .info-btn {
            flex: 1 1 auto;
            min-width: 160px;
            padding: 12px 18px;
            font-size: 1rem;
            border-radius: 60px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            transition: 0.2s;
            border: none;
        }
        .primary-btn {
            background: white;
            border: 2px solid #003b70;
            color: #003b70;
            font-weight: 600;
        }
        .primary-btn:hover {
            background: #003b70;
            color: white;
        }
        .secondary-btn {
            background: #ecf5ff;
            border: 1px solid #b0cbea;
            color: #002f60;
        }
        .secondary-btn:hover {
            background: #dae9fd;
        }
        .info-btn {
            background: #e4edf5;
            border: 1px solid #86aecf;
            color: #002a5a;
        }
        .info-btn:hover {
            background: #ccdef2;
        }
        /* virtual card */
        .virtual-section {
            background: white;
            border-radius: 24px;
            padding: 18px;
            border: 1px solid #bad2f0;
            display: none;
        }
        .virtual-section.visible {
            display: block;
        }
        .virtual-card-display {
            background: #e2edfc;
            border-radius: 18px;
            padding: 16px;
        }
        .virtual-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            background: white;
            padding: 10px 16px;
            border-radius: 40px;
            margin-bottom: 8px;
            font-size: 0.95rem;
            word-break: break-word;
            color: #001e3b;
            user-select: none;
        }
        .freeze-indicator {
            background: #cce0f5;
            border-radius: 40px;
            padding: 8px 16px;
            display: flex;
            gap: 8px;
            font-weight: 600;
            color: #002856;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }
        .blurred-card {
            filter: blur(4px);
        }
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* modals */
        .modal-overlay {
            position: fixed;
            top:0; left:0; width:100%; height:100%;
            background: rgba(0,20,40,0.6);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 16px;
        }
        .modal-card {
            background: white;
            max-width: 480px;
            width: 100%;
            border-radius: 48px;
            padding: 28px 22px;
            box-shadow: 0 40px 70px black;
            text-align: center;
        }
        .modal-icon { font-size: 3rem; color: #c5283d; margin-bottom: 12px; }
        .modal-title { font-size: 1.8rem; color: #001d39; }
        .modal-text { color: #2a4b74; margin: 18px 0; line-height: 1.5; }
        .modal-buttons { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        .modal-btn { padding: 12px 24px; border-radius: 40px; border: none; font-weight: 600; cursor: pointer; }
        .modal-btn.primary { background: #003f7f; color: white; }
        .modal-btn.secondary { background: #dee9f5; color: #001d3d; }
        .modal-btn.contact { background: #ffeed9; color: #a65d00; border: 1px solid #ffb347; }
        .close-icon { float: right; font-size: 2rem; cursor: pointer; }

        /* toast */
        .toast-message {
            background: #1e3e5c;
            color: white;
            padding: 14px 24px;
            border-radius: 60px;
            font-weight: 500;
            box-shadow: 0 15px 30px rgba(0,60,100,0.5);
            font-size: 0.95rem;
        }
        #temporaryToast {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 2000; display: none; width: 90%; max-width: 400px;
        }
        /* card info popup specifics */
        .info-row {
            display: flex;
            justify-content: space-between;
            background: #f0f5fe;
            padding: 14px 18px;
            border-radius: 50px;
            margin: 12px 0;
            align-items: center;
        }
        .copy-btn {
            background: #003f7f;
            color: white;
            border: none;
            padding: 6px 20px;
            border-radius: 40px;
            font-size: 0.9rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .copy-btn:hover { background: #002856; }
    </style>
</head>
<body>
    <div class="bank-app">
        <div class="header">
            <a href="#" class="back-link" onclick="alert('Returning to accounts summary')"><i class="fas fa-arrow-left"></i> Accounts</a>
            <h1>Card services</h1>
            <p>Anne Blanford • BEYOND physical</p>
        </div>

        <div class="main-layout">
            <!-- LEFT COLUMN -->
            <div class="left-column">
                <!-- 3D flip card -->
                <div class="card-3d-perspective">
                    <div class="card-3d" id="physicalCard3d">
                        <!-- FRONT -->
                        <div class="card-face front">
                            <div class="card-header-row">
                                <div class="chip"></div>
                                <span class="brand">BEYOND</span>
                            </div>
                            <div class="card-number" id="physicalCardNumber">1812 4270 5841 1570</div>
                            <div class="name-exp-row">
                                <span class="holder-name">ANNE BLANFORD</span>
                                <span class="expiry">01/27</span>
                            </div>
                            <div class="mastercard-icon"><i class="fab fa-cc-mastercard"></i></div>
                        </div>
                        <!-- BACK -->
                        <div class="card-face back">
                            <div class="mag-strip"></div>
                            <div class="cvv-block">
                                <span>CVV</span>
                                <span class="cvv-value" id="physicalCvv">265</span>
                            </div>
                            <div class="customer-service">
                                <i class="fas fa-envelope"></i> beyondtrustcustomerservice@gmail.com
                            </div>
                            <div class="legal-text">
                                This card is provided to customers for identification and service purposes. Please keep it safe. If lost/stolen, contact support immediately.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CARD INFO button (below card) -->
                <div style="display: flex; justify-content: center; margin: 10px 0 8px;">
                    <button class="info-btn" id="cardInfoBtn"><i class="fas fa-credit-card"></i> Card info</button>
                </div>

                <!-- billing address -->
                <div class="billing-panel" id="billingPanel">
                    <div class="billing-title"><i class="fas fa-map-pin"></i> Billing address</div>
                    <div class="billing-details">
                        <div class="bill-item"><span class="bill-label">Street</span><span class="bill-value">9300 COVE POINT</span></div>
                        <div class="bill-item"><span class="bill-label">City</span><span class="bill-value">BOYNTON BEACH</span></div>
                        <div class="bill-item"><span class="bill-label">State</span><span class="bill-value">FL</span></div>
                        <div class="bill-item"><span class="bill-label">ZIP</span><span class="bill-value">33472-2768</span></div>
                        <div class="bill-item"><span class="bill-label">Country</span><span class="bill-value">USA</span></div>
                    </div>
                </div>

                <!-- freeze & request buttons -->
                <div class="action-buttons">
                    <button class="primary-btn" id="freezePhysicalBtn"><i class="fas fa-snowflake"></i> <span id="freezeBtnText">Freeze physical card</span></button>
                    <button class="secondary-btn" id="requestVirtualBtn"><i class="fas fa-plus-circle"></i> Request virtual card</button>
                </div>
            </div>

            <!-- RIGHT COLUMN -->
            <div class="right-column">
                <h3 style="margin-bottom: 16px; display: flex; gap:8px; font-size:1.3rem;"><i class="fas fa-credit-card" style="color: #003f7f;"></i> Virtual card</h3>
                <div id="virtualCardContainer" class="virtual-section"></div>
                <div id="noVirtualPlaceholder" style="background: #ecf3fa; border-radius: 24px; padding: 30px 16px; text-align: center; color: #2f5575; border: 1px dashed #9bb5d4;">
                    <i class="fas fa-credit-card" style="font-size: 2.5rem; opacity: 0.5; margin-bottom: 12px;"></i>
                    <p>No virtual card yet. Click "Request virtual card" to generate one instantly.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <!-- Freeze confirmation modal (reused for attention) -->
    <div id="freezeModal" class="modal-overlay">
        <div class="modal-card">
            <i class="fas fa-times close-icon" onclick="closeModal()"></i>
            <div class="modal-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <div class="modal-title">Attention</div>
            <div class="modal-text" id="modalMessage"></div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="modalCancelBtn">Cancel</button>
                <button class="modal-btn primary" id="modalProceedBtn">Proceed</button>
                <button class="modal-btn contact" id="modalContactBtn"><i class="fas fa-headset"></i> Contact support</button>
            </div>
        </div>
    </div>

    <!-- CARD INFO POPUP MODAL -->
    <div id="cardInfoModal" class="modal-overlay">
        <div class="modal-card" style="max-width:500px;">
            <i class="fas fa-times close-icon" onclick="closeCardInfoModal()"></i>
            <div class="modal-icon"><i class="fas fa-id-card" style="color: #003f7f;"></i></div>
            <div class="modal-title">Physical card details</div>
            <div style="margin: 20px 0;">
                <div class="info-row">
                    <span style="font-weight:600;">Card number</span>
                    <span style="font-family:monospace;">1812 4270 5841 1570</span>
                    <button class="copy-btn" id="copyNumberBtn"><i class="fas fa-copy"></i> Copy</button>
                </div>
                <div class="info-row">
                    <span style="font-weight:600;">Holder</span>
                    <span>ANNE BLANFORD</span>
                    <button class="copy-btn" id="copyHolderBtn"><i class="fas fa-copy"></i> Copy</button>
                </div>
                <div class="info-row">
                    <span style="font-weight:600;">Expiry</span>
                    <span>01/27</span>
                    <button class="copy-btn" id="copyExpiryBtn"><i class="fas fa-copy"></i> Copy</button>
                </div>
                <div class="info-row">
                    <span style="font-weight:600;">CVV</span>
                    <span>265</span>
                    <button class="copy-btn" id="copyCvvBtn"><i class="fas fa-copy"></i> Copy</button>
                </div>
            </div>
            <button class="modal-btn primary" onclick="closeCardInfoModal()" style="margin-top:8px;">Close</button>
        </div>
    </div>

    <!-- Support modal -->
    <div id="supportModal" class="modal-overlay">
        <div class="modal-card">
            <i class="fas fa-times close-icon" onclick="closeSupportModal()"></i>
            <div class="modal-icon"><i class="fas fa-envelope-open-text" style="color: #004080;"></i></div>
            <div class="modal-title">Customer support</div>
            <div class="modal-text" style="font-size:1.2rem;">beyondtrustcustomerservice@gmail.com</div>
            <button class="modal-btn primary" onclick="closeSupportModal()">Close</button>
        </div>
    </div>

    <div id="temporaryToast"></div>

    <script>
        (function() {
            // Elements
            const physicalCard3d = document.getElementById('physicalCard3d');
            const physicalCvv = document.getElementById('physicalCvv');
            const physicalNumber = document.getElementById('physicalCardNumber');
            const billingPanel = document.getElementById('billingPanel');
            const freezeModal = document.getElementById('freezeModal');
            const supportModal = document.getElementById('supportModal');
            const cardInfoModal = document.getElementById('cardInfoModal');
            const modalMessage = document.getElementById('modalMessage');
            const modalCancelBtn = document.getElementById('modalCancelBtn');
            const modalProceedBtn = document.getElementById('modalProceedBtn');
            const modalContactBtn = document.getElementById('modalContactBtn');
            const toastDiv = document.getElementById('temporaryToast');
            const virtualContainer = document.getElementById('virtualCardContainer');
            const noVirtualPlaceholder = document.getElementById('noVirtualPlaceholder');
            const requestVirtualBtn = document.getElementById('requestVirtualBtn');
            const freezePhysicalBtn = document.getElementById('freezePhysicalBtn');
            const cardInfoBtn = document.getElementById('cardInfoBtn');

            // Storage keys
            const VIRTUAL_STORAGE_KEY = 'beyond_virtual_card_data';
            const PHYSICAL_STORAGE_KEY = 'beyond_physical_frozen';

            function showToast(text, duration = 2500) {
                toastDiv.style.display = 'block';
                toastDiv.innerHTML = `<div class="toast-message"><i class="fas fa-check-circle"></i> ${text}</div>`;
                setTimeout(() => { toastDiv.style.display = 'none'; }, duration);
            }

            window.closeModal = () => freezeModal.style.display = 'none';
            window.closeSupportModal = () => supportModal.style.display = 'none';
            window.closeCardInfoModal = () => cardInfoModal.style.display = 'none';

            // Flip card
            physicalCard3d.addEventListener('click', () => physicalCard3d.classList.toggle('flipped'));

            // Physical freeze state
            function applyPhysicalFrozenState() {
                const frozen = localStorage.getItem(PHYSICAL_STORAGE_KEY) === 'true';
                if (frozen) {
                    physicalNumber.classList.add('blurred');
                    physicalCvv.style.filter = 'blur(4px)';
                    billingPanel.classList.add('hidden');
                    freezePhysicalBtn.innerHTML = '<i class="fas fa-sun"></i> <span id="freezeBtnText">Unfreeze physical card</span>';
                } else {
                    physicalNumber.classList.remove('blurred');
                    physicalCvv.style.filter = 'none';
                    billingPanel.classList.remove('hidden');
                    freezePhysicalBtn.innerHTML = '<i class="fas fa-snowflake"></i> <span id="freezeBtnText">Freeze physical card</span>';
                }
                document.getElementById('freezeBtnText').innerText = freezePhysicalBtn.innerText.trim();
            }
            applyPhysicalFrozenState();

            freezePhysicalBtn.addEventListener('click', function() {
                const frozen = localStorage.getItem(PHYSICAL_STORAGE_KEY) === 'true';
                if (frozen) {
                    localStorage.setItem(PHYSICAL_STORAGE_KEY, 'false');
                    applyPhysicalFrozenState();
                    showToast('Physical card unfrozen. All functions restored.');
                } else {
                    modalMessage.innerText = 'Freezing your physical BEYOND card will block all POS, contactless, and ATM transactions. Billing address will be hidden. You can unfreeze anytime.';
                    freezeModal.style.display = 'flex';
                    // hide proceed, show freeze-specific buttons
                    modalProceedBtn.style.display = 'inline-block';
                    modalProceedBtn.innerText = 'Freeze card';
                    modalCancelBtn.innerText = 'Keep active';
                    modalProceedBtn.onclick = () => {
                        localStorage.setItem(PHYSICAL_STORAGE_KEY, 'true');
                        applyPhysicalFrozenState();
                        closeModal();
                        showToast('Physical card frozen. Billing address hidden.');
                    };
                    modalCancelBtn.onclick = closeModal;
                    modalContactBtn.onclick = () => { closeModal(); supportModal.style.display = 'flex'; };
                }
            });

            // CARD INFO BUTTON
            cardInfoBtn.addEventListener('click', () => {
                cardInfoModal.style.display = 'flex';
                setTimeout(() => {
                    document.getElementById('copyNumberBtn').onclick = () => {
                        navigator.clipboard.writeText('1812 4270 5841 1570').then(() => showToast('Card number copied'));
                    };
                    document.getElementById('copyHolderBtn').onclick = () => {
                        navigator.clipboard.writeText('ANNE BLANFORD').then(() => showToast('Holder name copied'));
                    };
                    document.getElementById('copyExpiryBtn').onclick = () => {
                        navigator.clipboard.writeText('01/27').then(() => showToast('Expiry date copied'));
                    };
                    document.getElementById('copyCvvBtn').onclick = () => {
                        navigator.clipboard.writeText('265').then(() => showToast('CVV copied'));
                    };
                }, 50);
            });

            // Virtual card render
            function renderVirtualCardFromStorage() {
                const stored = localStorage.getItem(VIRTUAL_STORAGE_KEY);
                if (stored) {
                    try {
                        const vc = JSON.parse(stored);
                        noVirtualPlaceholder.style.display = 'none';
                        virtualContainer.classList.add('visible');

                        const frozenClass = vc.frozen ? 'blurred-card' : '';
                        const freezeBtnIcon = vc.frozen ? 'fa-sun' : 'fa-snowflake';
                        const freezeBtnText = vc.frozen ? 'Unfreeze virtual card' : 'Freeze virtual card';
                        const freezeIndicator = vc.frozen ? '<div class="freeze-indicator"><i class="fas fa-snowflake"></i> Card frozen · web payments suspended</div>' : '';

                        virtualContainer.innerHTML = `
                            <div class="virtual-card-display">
                                ${freezeIndicator}
                                <div class="virtual-row ${frozenClass}">${vc.pan}</div>
                                <div class="virtual-row ${frozenClass}" style="justify-content: space-between;">
                                    <span>Exp: ${vc.expiry}</span> <span>CVV: ${vc.cvv}</span>
                                </div>
                                <div class="virtual-row ${frozenClass}">${vc.name}</div>
                                <button class="secondary-btn" id="freezeVirtualBtn" style="width:100%; margin-top:12px;"><i class="fas ${freezeBtnIcon}"></i> ${freezeBtnText}</button>
                                <button class="primary-btn" id="virtualContactBtn" style="width:100%; margin-top:8px; background:#eef5fc; color:#003f7f;"><i class="fas fa-envelope"></i> Contact support</button>
                            </div>
                        `;

                        document.getElementById('freezeVirtualBtn').addEventListener('click', function() {
                            const current = JSON.parse(localStorage.getItem(VIRTUAL_STORAGE_KEY));
                            if (current.frozen) {
                                current.frozen = false;
                                localStorage.setItem(VIRTUAL_STORAGE_KEY, JSON.stringify(current));
                                renderVirtualCardFromStorage();
                                showToast('Virtual card unfrozen. Online payments enabled.');
                            } else {
                                modalMessage.innerText = 'Freezing your virtual card will suspend all online transactions, tokenized payments, and digital wallet access. You can unfreeze anytime.';
                                freezeModal.style.display = 'flex';
                                modalProceedBtn.innerText = 'Freeze card';
                                modalCancelBtn.innerText = 'Keep active';
                                modalProceedBtn.onclick = () => {
                                    current.frozen = true;
                                    localStorage.setItem(VIRTUAL_STORAGE_KEY, JSON.stringify(current));
                                    renderVirtualCardFromStorage();
                                    closeModal();
                                    showToast('Virtual card frozen. Web payments suspended.');
                                };
                                modalCancelBtn.onclick = closeModal;
                                modalContactBtn.onclick = () => { closeModal(); supportModal.style.display = 'flex'; };
                            }
                        });

                        document.getElementById('virtualContactBtn').addEventListener('click', () => supportModal.style.display = 'flex');

                    } catch (e) { resetToNoCard(); }
                } else { resetToNoCard(); }
            }

            function resetToNoCard() {
                virtualContainer.classList.remove('visible');
                noVirtualPlaceholder.style.display = 'block';
            }

            // Request virtual card: first show attention popup (you have physical, proceed?)
            requestVirtualBtn.addEventListener('click', function() {
                const existingVirtual = localStorage.getItem(VIRTUAL_STORAGE_KEY);
                if (existingVirtual) {
                    // already have virtual → show block message (previous logic)
                    modalMessage.innerText = 'You already have a physical card and a virtual card linked to your account. To request an additional card, please contact customer support.';
                    freezeModal.style.display = 'flex';
                    modalProceedBtn.style.display = 'none';
                    modalCancelBtn.innerText = 'Close';
                    modalCancelBtn.onclick = closeModal;
                    modalContactBtn.onclick = () => { closeModal(); supportModal.style.display = 'flex'; };
                    return;
                }

                // Show attention: you have a physical card, do you still wish to proceed?
                modalMessage.innerText = 'You already have a physical card linked to your account. Do you still wish to request a virtual card?';
                freezeModal.style.display = 'flex';
                modalProceedBtn.style.display = 'inline-block';
                modalProceedBtn.innerText = 'Yes, proceed';
                modalCancelBtn.innerText = 'Cancel';
                modalProceedBtn.onclick = () => {
                    closeModal();
                    // now actually request virtual card
                    noVirtualPlaceholder.style.display = 'none';
                    virtualContainer.classList.add('visible');
                    virtualContainer.innerHTML = `<div style="text-align:center; padding:25px;"><span class="loader" style="margin:0 auto 15px;"></span><div>Requesting virtual card...</div></div>`;

                    setTimeout(() => {
                        const virtualCard = {
                            pan: '4512 7700 3391 2044',
                            expiry: '04/30',
                            cvv: '887',
                            name: 'ANNE BLANFORD',
                            frozen: false,
                        };
                        localStorage.setItem(VIRTUAL_STORAGE_KEY, JSON.stringify(virtualCard));
                        renderVirtualCardFromStorage();
                        showToast('Card request successful · Your virtual card is ready.', 3000);
                    }, 2000);
                };
                modalCancelBtn.onclick = closeModal;
                modalContactBtn.onclick = () => { closeModal(); supportModal.style.display = 'flex'; };
            });

            renderVirtualCardFromStorage();

            window.onclick = (e) => {
                if (e.target === freezeModal) closeModal();
                if (e.target === supportModal) closeSupportModal();
                if (e.target === cardInfoModal) closeCardInfoModal();
            };
        })();
    </script>
</body>
</html>
